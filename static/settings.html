<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Last War: Survival</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ® Last War: Survival</h1>
            <h2>Auto-Schedule Settings</h2>
            <div class="user-info">
                <div class="user-dropdown">
                    <button id="username-display" class="username-btn"></button>
                    <div id="user-dropdown-menu" class="dropdown-menu">
                        <a href="/profile.html" class="dropdown-item">ğŸ‘¤ Profile</a>
                        <a href="/admin.html" class="dropdown-item admin-only" id="admin-dropdown-link" style="display: none;">ğŸ” Admin Panel</a>
                        <div class="dropdown-divider"></div>
                        <div class="theme-section">
                            <div class="theme-section-label">Theme</div>
                            <a href="#" class="dropdown-item theme-option" data-theme="auto">â— Auto (System)</a>
                            <a href="#" class="dropdown-item theme-option" data-theme="light">â—‹ Light</a>
                            <a href="#" class="dropdown-item theme-option" data-theme="dark">â—‹ Dark</a>
                        </div>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item" id="dropdown-logout-btn">ğŸšª Logout</a>
                    </div>
                </div>
            </div>
        </header>

        <nav class="nav-menu">
            <a href="/" class="nav-link">ğŸ‘¥ Members</a>
            <a href="/train.html" class="nav-link">ğŸš‚ Train</a>
            <a href="/awards.html" class="nav-link">ğŸ† Awards</a>
            <a href="/recommendations.html" class="nav-link">â­ Recs</a>
            <a href="/rankings.html" class="nav-link">ğŸ“Š Rankings</a>
            <a href="/storm.html" class="nav-link">ğŸœï¸ Storm</a>
            <a href="/upload.html" class="nav-link">ğŸ“¸ Upload</a>
            <a href="/settings.html" class="nav-link active">âš™ï¸ Settings</a>
        </nav>

        <main>
            <section class="form-section">
                <h3>Ranking System Configuration</h3>
                <p class="info-text">Configure the point system used for auto-scheduling train conductors. Higher points = higher priority.</p>
                
                <form id="settings-form">
                    <div class="settings-group">
                        <h4>ğŸ† Award Points</h4>
                        <div class="form-group">
                            <label for="award-first">1st Place Award:</label>
                            <input type="number" id="award-first" min="0" required>
                            <span class="help-text">Points given for being 1st in any weekly award</span>
                        </div>
                        <div class="form-group">
                            <label for="award-second">2nd Place Award:</label>
                            <input type="number" id="award-second" min="0" required>
                            <span class="help-text">Points given for being 2nd in any weekly award</span>
                        </div>
                        <div class="form-group">
                            <label for="award-third">3rd Place Award:</label>
                            <input type="number" id="award-third" min="0" required>
                            <span class="help-text">Points given for being 3rd in any weekly award</span>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h4>â­ Recommendation Points</h4>
                        <div class="info-box">
                            <p><strong>Non-Linear Scoring Formula:</strong> Points = 5 + 5 Ã— âˆšn</p>
                            <p class="help-text">Where n = number of recommendations. This creates diminishing returns for multiple recommendations.</p>
                            <p class="help-text">Examples: 1 rec = 10 pts, 4 recs = 15 pts, 9 recs = 20 pts</p>
                        </div>
                        <p class="help-text"><em>Note: Recommendation points are calculated using a non-linear formula and cannot be manually configured.</em></p>
                    </div>

                    <div class="settings-group">
                        <h4>â±ï¸ Recent Conductor Penalty</h4>
                        <div class="form-group">
                            <label for="recent-conductor-days">Penalty Duration (days):</label>
                            <input type="number" id="recent-conductor-days" min="1" required>
                            <span class="help-text">Remove (this value - days since last conductor) points. If â‰¤0, member won't be penalized.</span>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h4>ğŸ“Š Above Average Penalty</h4>
                        <div class="form-group">
                            <label for="above-average-penalty">Penalty Points:</label>
                            <input type="number" id="above-average-penalty" min="0" required>
                            <span class="help-text">Points removed if member has been conductor more than average</span>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h4>â­ R4/R5 Rank Boost</h4>
                        <div class="form-group">
                            <label for="r4r5-rank-boost">Bonus Points:</label>
                            <input type="number" id="r4r5-rank-boost" min="0" required>
                            <span class="help-text">Bonus points given to R4 and R5 members</span>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h4>ğŸ¯ First Time Conductor Boost</h4>
                        <div class="form-group">
                            <label for="first-time-boost">Bonus Points:</label>
                            <input type="number" id="first-time-boost" min="0" required>
                            <span class="help-text">Bonus points for members who have never been conductor before (only if they have some points)</span>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h4>âš¡ Power Tracking</h4>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="power-tracking-enabled">
                                Enable Power Tracking
                            </label>
                            <span class="help-text">When enabled, you can upload screenshots to track member power history and other data</span>
                        </div>
                        
                        <div id="power-upload-link" style="display: none; margin-top: 15px; padding: 15px; background: #eff0fb; border-radius: 8px; border: 2px solid #667eea;">
                            <p style="margin: 0 0 10px 0; color: #667eea; font-weight: bold;">ğŸ“¸ Screenshot Upload Available</p>
                            <p style="margin: 0 0 10px 0; font-size: 14px;">Visit the dedicated Upload page to process game screenshots with OCR or manually enter data.</p>
                            <a href="/upload.html" class="primary-btn" style="display: inline-block; text-decoration: none; padding: 10px 20px;">ğŸ“¸ Go to Upload Page</a>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h4>ğŸ“ Weekly Schedule Message Template</h4>
                        <div class="form-group">
                            <label for="schedule-message-template">Message Template:</label>
                            <textarea id="schedule-message-template" rows="8" required></textarea>
                            <span class="help-text">
                                Template for in-game copy message. Use:<br>
                                <code>{WEEK}</code> = Week start date<br>
                                <code>{SCHEDULES}</code> = Daily schedules<br>
                                <code>{NEXT_3}</code> = Next 3 candidates
                            </span>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h4>ğŸ“¨ Daily Message Template</h4>
                        <div class="form-group">
                            <label for="daily-message-template">Message Template:</label>
                            <textarea id="daily-message-template" rows="10" required></textarea>
                            <span class="help-text">
                                Template for daily conductor reminder. Use:<br>
                                <code>{DATE}</code> = Date (e.g., Monday, Jan 2, 2006)<br>
                                <code>{CONDUCTOR_NAME}</code> = Conductor's name<br>
                                <code>{CONDUCTOR_RANK}</code> = Conductor's rank<br>
                                <code>{BACKUP_NAME}</code> = Backup's name<br>
                                <code>{BACKUP_RANK}</code> = Backup's rank
                            </span>
                        </div>
                    </div>

                    <div class="button-group">
                        <button type="submit" class="primary-btn">ğŸ’¾ Save Settings</button>
                        <button type="button" id="reset-btn" class="secondary-btn">ğŸ”„ Reset to Defaults</button>
                    </div>
                </form>
            </section>

            <section class="info-section">
                <h3>â„¹ï¸ How the Ranking System Works</h3>
                <div class="info-card">
                    <p><strong>Auto-Schedule Selection:</strong> When you auto-schedule, the system calculates a score for each eligible member:</p>
                    <ul>
                        <li><strong>Base Score:</strong> Starts at 0</li>
                        <li><strong>Awards:</strong> Adds points based on active awards (1st/2nd/3rd place). Awards stack across weeks until member conducts.</li>
                        <li><strong>Recommendations:</strong> Adds points using non-linear formula: 5 + 5Ã—âˆšn (where n = recommendation count). Recommendations stack until member conducts.</li>
                        <li><strong>Rank Boost:</strong> R4 and R5 members receive bonus points</li>
                        <li><strong>First Timer:</strong> Members who have never been conductor receive bonus points (if they have some base points)</li>
                        <li><strong>Recent Conductor:</strong> Subtracts points if they were conductor recently (penalty = days_config - days_since_last, minimum 0)</li>
                        <li><strong>Above Average:</strong> Subtracts points if they've been conductor more times than the average member</li>
                    </ul>
                    <p><strong>Member Eligibility:</strong> Only members marked as "Eligible for Train" are considered for auto-scheduling. You can toggle eligibility on the Members page.</p>
                    <p><strong>Award/Recommendation Expiration:</strong> Awards and recommendations automatically become inactive (expire) when the member is assigned as conductor or used as backup. This is calculated on-the-fly based on conductor history.</p>
                    <p><strong>Selection Priority:</strong> The member with the highest score who is eligible is selected as conductor. The system aims to schedule 7 unique conductors per week.</p>
                </div>
            </section>
        </main>
    </div>

    <script src="theme.js"></script>
    <script src="settings.js"></script>
</body>
</html>
