<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Last War: Survival</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üéÆ Last War: Survival</h1>
            <h2>Auto-Schedule Settings</h2>
            <div class="user-info">
                <span id="username-display"></span>
                <button id="logout-btn" class="logout-btn">Logout</button>
            </div>
        </header>

        <nav class="nav-menu">
            <a href="/" class="nav-link">üë• Members</a>
            <a href="/train.html" class="nav-link">üöÇ Train Schedule</a>
            <a href="/awards.html" class="nav-link">üèÜ Awards</a>
            <a href="/recommendations.html" class="nav-link">‚≠ê Recommendations</a>
            <a href="/rankings.html" class="nav-link">üìä Rankings</a>
            <a href="/storm.html" class="nav-link">üèúÔ∏è Desert Storm</a>
            <a href="/settings.html" class="nav-link active">‚öôÔ∏è Settings</a>
            <a href="/profile.html" class="nav-link">üë§ Profile</a>
        </nav>

        <main>
            <section class="form-section">
                <h3>Ranking System Configuration</h3>
                <p class="info-text">Configure the point system used for auto-scheduling train conductors. Higher points = higher priority.</p>
                
                <form id="settings-form">
                    <div class="settings-group">
                        <h4>üèÜ Award Points</h4>
                        <div class="form-group">
                            <label for="award-first">1st Place Award:</label>
                            <input type="number" id="award-first" min="0" required>
                            <span class="help-text">Points given for being 1st in any weekly award</span>
                        </div>
                        <div class="form-group">
                            <label for="award-second">2nd Place Award:</label>
                            <input type="number" id="award-second" min="0" required>
                            <span class="help-text">Points given for being 2nd in any weekly award</span>
                        </div>
                        <div class="form-group">
                            <label for="award-third">3rd Place Award:</label>
                            <input type="number" id="award-third" min="0" required>
                            <span class="help-text">Points given for being 3rd in any weekly award</span>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h4>‚≠ê Recommendation Points</h4>
                        <div class="info-box">
                            <p><strong>Non-Linear Scoring Formula:</strong> Points = 5 + 5 √ó ‚àön</p>
                            <p class="help-text">Where n = number of recommendations. This creates diminishing returns for multiple recommendations.</p>
                            <p class="help-text">Examples: 1 rec = 10 pts, 4 recs = 15 pts, 9 recs = 20 pts</p>
                        </div>
                        <p class="help-text"><em>Note: Recommendation points are calculated using a non-linear formula and cannot be manually configured.</em></p>
                    </div>

                    <div class="settings-group">
                        <h4>‚è±Ô∏è Recent Conductor Penalty</h4>
                        <div class="form-group">
                            <label for="recent-conductor-days">Penalty Duration (days):</label>
                            <input type="number" id="recent-conductor-days" min="1" required>
                            <span class="help-text">Remove (this value - days since last conductor) points. If ‚â§0, member won't be penalized.</span>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h4>üìä Above Average Penalty</h4>
                        <div class="form-group">
                            <label for="above-average-penalty">Penalty Points:</label>
                            <input type="number" id="above-average-penalty" min="0" required>
                            <span class="help-text">Points removed if member has been conductor more than average</span>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h4>‚≠ê R4/R5 Rank Boost</h4>
                        <div class="form-group">
                            <label for="r4r5-rank-boost">Bonus Points:</label>
                            <input type="number" id="r4r5-rank-boost" min="0" required>
                            <span class="help-text">Bonus points given to R4 and R5 members</span>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h4>üéØ First Time Conductor Boost</h4>
                        <div class="form-group">
                            <label for="first-time-boost">Bonus Points:</label>
                            <input type="number" id="first-time-boost" min="0" required>
                            <span class="help-text">Bonus points for members who have never been conductor before (only if they have some points)</span>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h4>‚ö° Power Tracking</h4>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="power-tracking-enabled">
                                Enable Power Tracking
                            </label>
                            <span class="help-text">When enabled, you can upload power rankings screenshots to track member power history</span>
                        </div>
                        
                        <div id="power-upload-section" style="display: none; margin-top: 20px; padding: 20px; background: white; border-radius: 10px; border: 2px solid #667eea;">
                            <h5 style="margin: 0 0 15px 0; color: #667eea;">üì∏ Upload Power Rankings</h5>
                            
                            <!-- Tab selection -->
                            <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #e9ecef;">
                                <button type="button" id="tab-image" class="tab-button active" style="padding: 10px 20px; border: none; background: none; cursor: pointer; border-bottom: 3px solid #667eea; font-weight: bold; color: #667eea;">üì∑ Image Upload</button>
                                <button type="button" id="tab-text" class="tab-button" style="padding: 10px 20px; border: none; background: none; cursor: pointer; border-bottom: 3px solid transparent; color: #6c757d;">‚úçÔ∏è Manual Entry</button>
                            </div>
                            
                            <!-- Image upload tab -->
                            <div id="image-upload-tab" class="upload-tab">
                                <p style="font-size: 0.9em; color: #6c757d; margin-bottom: 15px;">Upload a screenshot of power rankings (supports OCR)</p>
                                <input type="file" id="power-image-input" accept="image/*" style="display: none;">
                                <div id="image-drop-zone" style="border: 2px dashed #dee2e6; border-radius: 8px; padding: 40px; text-align: center; cursor: pointer; background: #f8f9fa;">
                                    <div id="drop-zone-content">
                                        <span style="font-size: 48px;">üìÅ</span>
                                        <p style="margin: 10px 0 5px 0; font-weight: bold;">Click to upload or drag & drop</p>
                                        <p style="margin: 0; font-size: 0.9em; color: #6c757d;">PNG, JPG, JPEG - Max 10MB</p>
                                    </div>
                                    <div id="image-preview" style="display: none;">
                                        <img id="preview-img" style="max-width: 100%; max-height: 300px; border-radius: 8px; margin-bottom: 10px;">
                                        <p id="preview-filename" style="margin: 5px 0; font-size: 0.9em; color: #6c757d;"></p>
                                        <button type="button" id="clear-image-btn" class="secondary-btn" style="margin-top: 10px;">üóëÔ∏è Remove Image</button>
                                    </div>
                                </div>
                                <button type="button" id="process-image-btn" class="primary-btn" style="margin-top: 15px; width: 100%; display: none;">üîç Process Image with OCR</button>
                            </div>
                            
                            <!-- Manual text entry tab -->
                            <div id="text-upload-tab" class="upload-tab" style="display: none;">
                                <p style="font-size: 0.9em; color: #6c757d; margin-bottom: 15px;">Paste power data (one per line): Name, Power</p>
                                <textarea id="power-data-input" rows="10" placeholder="Example:&#10;Gary6126, 71407341&#10;Anjel87, 55456932&#10;ileesu, 52325609" style="width: 100%; padding: 10px; border: 2px solid #dee2e6; border-radius: 8px; font-family: monospace; font-size: 14px;"></textarea>
                                <button type="button" id="process-power-btn" class="primary-btn" style="margin-top: 10px; width: 100%;">üì§ Upload Power Data</button>
                            </div>
                            
                            <div id="power-upload-result" style="margin-top: 15px; display: none;"></div>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h4>üìù Weekly Schedule Message Template</h4>
                        <div class="form-group">
                            <label for="schedule-message-template">Message Template:</label>
                            <textarea id="schedule-message-template" rows="8" required></textarea>
                            <span class="help-text">
                                Template for in-game copy message. Use:<br>
                                <code>{WEEK}</code> = Week start date<br>
                                <code>{SCHEDULES}</code> = Daily schedules<br>
                                <code>{NEXT_3}</code> = Next 3 candidates
                            </span>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h4>üì® Daily Message Template</h4>
                        <div class="form-group">
                            <label for="daily-message-template">Message Template:</label>
                            <textarea id="daily-message-template" rows="10" required></textarea>
                            <span class="help-text">
                                Template for daily conductor reminder. Use:<br>
                                <code>{DATE}</code> = Date (e.g., Monday, Jan 2, 2006)<br>
                                <code>{CONDUCTOR_NAME}</code> = Conductor's name<br>
                                <code>{CONDUCTOR_RANK}</code> = Conductor's rank<br>
                                <code>{BACKUP_NAME}</code> = Backup's name<br>
                                <code>{BACKUP_RANK}</code> = Backup's rank
                            </span>
                        </div>
                    </div>

                    <div class="button-group">
                        <button type="submit" class="primary-btn">üíæ Save Settings</button>
                        <button type="button" id="reset-btn" class="secondary-btn">üîÑ Reset to Defaults</button>
                    </div>
                </form>
            </section>

            <section class="info-section">
                <h3>‚ÑπÔ∏è How the Ranking System Works</h3>
                <div class="info-card">
                    <p><strong>Auto-Schedule Selection:</strong> When you auto-schedule, the system calculates a score for each eligible member:</p>
                    <ul>
                        <li><strong>Base Score:</strong> Starts at 0</li>
                        <li><strong>Awards:</strong> Adds points based on active awards (1st/2nd/3rd place). Awards stack across weeks until member conducts.</li>
                        <li><strong>Recommendations:</strong> Adds points using non-linear formula: 5 + 5√ó‚àön (where n = recommendation count). Recommendations stack until member conducts.</li>
                        <li><strong>Rank Boost:</strong> R4 and R5 members receive bonus points</li>
                        <li><strong>First Timer:</strong> Members who have never been conductor receive bonus points (if they have some base points)</li>
                        <li><strong>Recent Conductor:</strong> Subtracts points if they were conductor recently (penalty = days_config - days_since_last, minimum 0)</li>
                        <li><strong>Above Average:</strong> Subtracts points if they've been conductor more times than the average member</li>
                    </ul>
                    <p><strong>Member Eligibility:</strong> Only members marked as "Eligible for Train" are considered for auto-scheduling. You can toggle eligibility on the Members page.</p>
                    <p><strong>Award/Recommendation Expiration:</strong> Awards and recommendations automatically become inactive (expire) when the member is assigned as conductor or used as backup. This is calculated on-the-fly based on conductor history.</p>
                    <p><strong>Selection Priority:</strong> The member with the highest score who is eligible is selected as conductor. The system aims to schedule 7 unique conductors per week.</p>
                </div>
            </section>
        </main>
    </div>

    <script src="settings.js"></script>
</body>
</html>
